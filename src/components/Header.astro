---
import ThemeToggle from './ThemeToggle.astro';

const dropdownLinks = [
  {
    label: 'Committees',
    basePath: '/committees',
    items: [
      { href: '/committees/voting', label: 'Voting' },
      { href: '/committees/education', label: 'Education' },
      { href: '/committees/publicity', label: 'Publicity' },
      { href: '/committees/membership', label: 'Membership' },
    ],
  },
  {
    label: 'Get Involved',
    basePath: '/get-involved',
    items: [
      { href: '/get-involved/volunteer', label: 'Volunteer' },
      { href: '/get-involved/donate', label: 'Donate' },
      { href: '/get-involved/join', label: 'Join' },
    ],
  },
  {
    label: 'About',
    basePath: '/about',
    items: [
      { href: '/about', label: 'About Indivisible' },
      { href: '/about/our-chapter', label: 'Our Chapter' },
      { href: '/about/history', label: 'History' },
    ],
  },
];

const flatLinks = [
  { href: '/blog', label: 'Blog' },
  { href: '/events', label: 'Events' },
  { href: '/resources', label: 'Resources' },
  { href: '/contact', label: 'Contact' },
];

const currentPath = Astro.url.pathname;

function isDropdownActive(basePath: string): boolean {
  return currentPath === basePath || currentPath.startsWith(basePath + '/');
}

function isFlatActive(href: string): boolean {
  return currentPath === href || (href !== '/' && currentPath.startsWith(href + '/'));
}
---

<header class="border-b border-[var(--color-border)] bg-[var(--color-bg)]">
  <nav class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between gap-4">
    <a href="/" class="flex items-center gap-3 hover:opacity-80 transition-opacity shrink-0">
      <img
        src="/images/Taquitz-logo.jpg"
        alt="Idyllwild Indivisible"
        class="h-[60px] w-auto"
      />
      <span class="font-semibold text-lg leading-tight">Idyllwild Indivisible</span>
    </a>

    <div class="flex items-center gap-2">
      <ul class="flex items-center gap-1 flex-wrap">
        {dropdownLinks.map((dropdown) => (
          <li class="relative group">
            <button
              class:list={[
                'flex items-center gap-1 px-3 py-2 text-sm font-medium rounded transition-colors hover:text-[var(--color-accent)]',
                isDropdownActive(dropdown.basePath)
                  ? 'text-[var(--color-accent)]'
                  : 'text-[var(--color-text-secondary)]',
              ]}
            >
              {dropdown.label}
              <svg class="w-3 h-3 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
            <ul class="absolute left-0 top-full w-48 py-1 bg-[var(--color-bg)] border border-[var(--color-border)] rounded-lg shadow-lg invisible opacity-0 group-hover:visible group-hover:opacity-100 transition-all duration-150 z-50">
              {dropdown.items.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class:list={[
                      'block px-4 py-2 text-sm transition-colors hover:bg-[var(--color-bg-secondary)]',
                      currentPath === item.href
                        ? 'text-[var(--color-accent)] font-medium'
                        : 'text-[var(--color-text)]',
                    ]}
                  >
                    {item.label}
                  </a>
                </li>
              ))}
            </ul>
          </li>
        ))}

        {flatLinks.map((link) => (
          <li>
            <a
              href={link.href}
              class:list={[
                'px-3 py-2 text-sm font-medium rounded transition-colors hover:text-[var(--color-accent)]',
                isFlatActive(link.href)
                  ? 'text-[var(--color-accent)]'
                  : 'text-[var(--color-text-secondary)]',
              ]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <ThemeToggle />
    </div>
  </nav>
</header>

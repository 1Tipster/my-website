---
interface Props {
  title: string;
  description: string;
  date: Date;
  endDate?: Date;
  location?: string;
  url?: string;
  slug: string;
  photoCount?: number;
}

const { title, description, date, endDate, location, url, slug, photoCount = 0 } = Astro.props;

function formatDate(d: Date): string {
  return d.toLocaleDateString('en-us', {
    weekday: 'short',
    year: 'numeric',
    month: 'short',
    day: 'numeric',
  });
}

function formatTime(d: Date): string {
  return d.toLocaleTimeString('en-us', {
    hour: 'numeric',
    minute: '2-digit',
  });
}

const isPast = date < new Date();
---

<a href={`/events/${slug}/`} class="group block">
  <article class:list={[
    'rounded-xl border border-[var(--color-border)] p-5 hover:border-[var(--color-accent)] transition-colors',
    isPast ? 'opacity-60' : '',
  ]}>
    <div class="flex items-start gap-4">
      <div class="flex-shrink-0 text-center bg-[var(--color-accent)]/10 rounded-lg p-3 min-w-[60px]">
        <div class="text-xs font-medium text-[var(--color-accent)] uppercase">
          {date.toLocaleDateString('en-us', { month: 'short' })}
        </div>
        <div class="text-2xl font-bold text-[var(--color-accent)]">
          {date.getDate()}
        </div>
      </div>
      <div class="flex-1">
        <h3 class="text-lg font-semibold group-hover:text-[var(--color-accent)] transition-colors">
          {title}
        </h3>
        <div class="flex flex-wrap gap-3 text-xs text-[var(--color-text-secondary)] mt-1">
          <time datetime={date.toISOString()}>
            {formatDate(date)} at {formatTime(date)}
          </time>
          {endDate && (
            <span>- {formatDate(endDate)} at {formatTime(endDate)}</span>
          )}
          {location && (
            <span class="flex items-center gap-1">
              <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
              {location}
            </span>
          )}
        </div>
        <p class="text-sm text-[var(--color-text-secondary)] mt-2">{description}</p>
        <div class="flex items-center gap-3 mt-2">
          {url && (
            <span class="text-xs text-[var(--color-accent)]">Has external link &nearr;</span>
          )}
          {photoCount > 0 && (
            <span class="text-xs text-[var(--color-text-secondary)]">
              {photoCount} photo{photoCount !== 1 ? 's' : ''}
            </span>
          )}
          {isPast && <span class="text-xs text-[var(--color-text-secondary)] italic">Past event</span>}
        </div>
      </div>
    </div>
  </article>
</a>
